<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼è¨˜éŒ²ã‚¢ãƒ—ãƒª</title>
<link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Kosugi Maru', sans-serif;
    background: #fff0f0;
    color: #6b2b2b;
    padding: 20px;
    margin: 0;
  }
  h1 {
    color: #d43c54;
    margin-bottom: 10px;
    position: relative;
  }

  /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºãƒœã‚¿ãƒ³ */
  .calendar-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }

  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ */
  form.input-form {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, auto);
    gap: 14px 20px;
    margin-top: 50px; /* ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸‹ã«ä½™è£•ã‚’ */
    max-width: 480px;
  }
  .input-group {
    display: flex;
    flex-direction: column;
  }
  .input-group label {
    font-weight: bold;
    margin-bottom: 6px;
    color: #b71c1c; /* æ¿ƒã„èµ¤ */
    font-size: 14px;
  }
  .input-group input,
  .input-group select {
    padding: 8px 10px;
    font-size: 16px;
    border: 2px solid #f8bbd0; /* è–„ãƒ”ãƒ³ã‚¯ */
    border-radius: 8px;
    width: 100%;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
  }
  .input-group input:focus,
  .input-group select:focus {
    border-color: #ef6c00; /* ã‚ªãƒ¬ãƒ³ã‚¸ */
    outline: none;
  }

  /* è¨˜éŒ²è¿½åŠ ãƒœã‚¿ãƒ³ */
  button#addEntryBtn {
    grid-column: span 2;
    margin-top: 8px;
    background: linear-gradient(45deg, #ef5350, #f48fb1);
    border: none;
    color: white;
    font-weight: bold;
    font-size: 16px;
    padding: 10px 0;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(244, 143, 177, 0.6);
    transition: background 0.3s ease;
  }
  button#addEntryBtn:hover {
    background: linear-gradient(45deg, #d32f2f, #f06292);
  }

  /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼†å…¨å‰Šé™¤ãƒœã‚¿ãƒ³è¡Œ */
  .button-row {
    max-width: 480px;
    margin: 15px 0 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button#clearAllBtn {
    background: linear-gradient(45deg, #fb8c00, #ffb74d);
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    font-size: 15px;
    color: #4e342e;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(255, 183, 77, 0.6);
    transition: background 0.3s ease;
  }
  button#clearAllBtn:hover {
    background: linear-gradient(45deg, #ef6c00, #ffa726);
  }
  button#openRegisterBtn {
    background: linear-gradient(45deg, #ef5350, #f48fb1);
    border: none;
    border-radius: 10px;
    padding: 10px 18px;
    font-size: 15px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(244, 143, 177, 0.6);
    transition: background 0.3s ease;
  }
  button#openRegisterBtn:hover {
    background: linear-gradient(45deg, #d32f2f, #f06292);
  }

  /* ãƒ†ãƒ¼ãƒ–ãƒ« */
  table {
    width: 100%;
    max-width: 480px;
    border-collapse: collapse;
    background: #fff0f5;
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    border: 1px solid #f8bbd0;
    padding: 10px;
    text-align: center;
    font-size: 14px;
    color: #6b2b2b;
  }
  th {
    background: #f48fb1;
    color: white;
  }

  /* åˆè¨ˆè¡¨ç¤º */
  #totalCalories {
    max-width: 480px;
    margin: 12px 0 30px;
    font-size: 18px;
    font-weight: bold;
    color: #b71c1c;
  }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .modal {
    display: none;
    position: fixed;
    z-index: 99;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(150, 100, 120, 0.6);
    backdrop-filter: blur(4px);
  }
  .modal-content {
    background: #fff0f5;
    margin: 5% auto;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 460px;
    box-shadow: 0 0 15px rgba(244, 143, 177, 0.8);
    position: relative;
  }
  .close {
    position: absolute;
    right: 18px;
    top: 14px;
    font-size: 26px;
    font-weight: bold;
    color: #b71c1c;
    cursor: pointer;
  }

  /* ç™»éŒ²æ¸ˆã¿é£Ÿå“ãƒªã‚¹ãƒˆ */
  #foodListDisplay li {
    margin-bottom: 8px;
    font-size: 15px;
    color: #6b2b2b;
  }
  #foodListDisplay button {
    margin-left: 12px;
    background: #f48fb1;
    border: none;
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 13px;
    color: white;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #foodListDisplay button:hover {
    background: #d32f2f;
  }
</style>
</head>
<body>

<h1>
  æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼è¨˜éŒ²
  <button class="calendar-button btn" onclick="openCalendarModal()" aria-label="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºãƒœã‚¿ãƒ³" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º">ğŸ“…</button>
</h1>

<form class="input-form" onsubmit="event.preventDefault(); addEntry();">
  <div class="input-group">
    <label for="calendarDate">æ—¥ä»˜</label>
    <input type="date" id="calendarDate" required />
  </div>
  <div class="input-group">
    <label for="timeSelect">æ™‚é–“</label>
    <select id="timeSelect" required>
      <option value="æœé£Ÿ">æœé£Ÿ</option>
      <option value="æ˜¼é£Ÿ">æ˜¼é£Ÿ</option>
      <option value="å¤•é£Ÿ">å¤•é£Ÿ</option>
      <option value="é–“é£Ÿ">é–“é£Ÿ</option>
    </select>
  </div>
  <div class="input-group">
    <label for="foodSelect">é£Ÿå“</label>
    <select id="foodSelect" required></select>
  </div>
  <div class="input-group">
    <label for="quantity">æ•°é‡</label>
    <select id="quantity" required></select>
  </div>
  <button id="addEntryBtn" type="submit">è¨˜éŒ²ã‚’è¿½åŠ </button>
</form>

<div class="button-row">
  <button id="clearAllBtn" type="button" onclick="clearAll()">ã™ã¹ã¦å‰Šé™¤</button>
  <button id="openRegisterBtn" type="button" onclick="openRegisterModal()">é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã¸</button>
</div>

<table>
  <thead>
    <tr>
      <th>æ™‚é–“</th>
      <th>é£Ÿå“å</th>
      <th>æ•°é‡</th>
      <th>ã‚«ãƒ­ãƒªãƒ¼</th>
    </tr>
  </thead>
  <tbody id="entryTableBody"></tbody>
</table>

<div id="totalCalories">åˆè¨ˆ: 0 kcal</div>

<!-- é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="registerModal" class="modal" aria-hidden="true" aria-labelledby="registerTitle" role="dialog">
  <div class="modal-content">
    <span class="close" onclick="closeRegisterModal()" aria-label="é–‰ã˜ã‚‹">&times;</span>
    <h2 id="registerTitle" style="color:#b71c1c;">é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²</h2>
    <form id="foodRegisterForm" onsubmit="event.preventDefault(); addFoodData();">
      <div class="input-group">
        <label for="foodNameInput">é£Ÿå“å</label>
        <input type="text" id="foodNameInput" required />
      </div>
      <div class="input-group">
        <label for="foodCalorieInput">ã‚«ãƒ­ãƒªãƒ¼ (1å˜ä½ã‚ãŸã‚Š)</label>
        <input type="number" id="foodCalorieInput" min="1" required />
      </div>
      <button class="btn btn-primary" type="submit" style="margin-top: 12px;">ç™»éŒ²</button>
    </form>
  </div>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="calendarModal" class="modal" aria-hidden="true" aria-labelledby="calendarTitle" role="dialog">
  <div class="modal-content">
    <span class="close" onclick="closeCalendarModal()" aria-label="é–‰ã˜ã‚‹">&times;</span>
    <h2 id="calendarTitle" style="color:#b71c1c;">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§è¨˜éŒ²ç¢ºèª</h2>
    <div id="calendarContainer" style="overflow-x:auto;">
      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã“ã“ã«ç”Ÿæˆ -->
    </div>
  </div>
</div>

<script>
  // --- ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ– ---
  let foodData = JSON.parse(localStorage.getItem('foodData') || '[]');
  let entries = JSON.parse(localStorage.getItem('entries') || '[]');

  // --- ç”»é¢ãƒ­ãƒ¼ãƒ‰æ™‚ ---
  window.onload = function() {
    populateFoodSelect();
    populateQuantitySelect();
    renderEntries();
  };

  // é£Ÿå“é¸æŠè‚¢ã‚’ä½œæˆ
  function populateFoodSelect() {
    const foodSelect = document.getElementById('foodSelect');
    foodSelect.innerHTML = '';
    if (foodData.length === 0) {
      foodSelect.innerHTML = '<option disabled>ç™»éŒ²ã•ã‚ŒãŸé£Ÿå“ãŒã‚ã‚Šã¾ã›ã‚“</option>';
      return;
    }
    foodData.forEach(food => {
      const opt = document.createElement('option');
      opt.value = food.name;
      opt.textContent = food.name + ' (' + food.calorie + ' kcal/å˜ä½)';
      foodSelect.appendChild(opt);
    });
  }

  // æ•°é‡é¸æŠè‚¢ã‚’ä½œæˆ (1ï½10)
  function populateQuantitySelect() {
    const quantitySelect = document.getElementById('quantity');
    quantitySelect.innerHTML = '';
    for (let i = 1; i <= 10; i++) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = i;
      quantitySelect.appendChild(opt);
    }
  }

  // è¨˜éŒ²ã‚’è¿½åŠ 
  function addEntry() {
    const date = document.getElementById('calendarDate').value;
    const time = document.getElementById('timeSelect').value;
    const foodName = document.getElementById('foodSelect').value;
    const quantity = Number(document.getElementById('quantity').value);

    if (!date || !time || !foodName || !quantity) {
      alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    const food = foodData.find(f => f.name === foodName);
    if (!food) {
      alert('é¸æŠã•ã‚ŒãŸé£Ÿå“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    const calorie = food.calorie * quantity;

    entries.push({ date, time, foodName, quantity, calorie });
    localStorage.setItem('entries', JSON.stringify(entries));

    renderEntries();
    resetInputFields();
  }

  // å…¥åŠ›æ¬„ãƒªã‚»ãƒƒãƒˆ
  function resetInputFields() {
    document.getElementById('calendarDate').value = '';
    document.getElementById('timeSelect').selectedIndex = 0;
    if (foodData.length > 0) document.getElementById('foodSelect').selectedIndex = 0;
    document.getElementById('quantity').selectedIndex = 0;
  }

  // è¨˜éŒ²è¡¨ç¤º
  function renderEntries() {
    const tbody = document.getElementById('entryTableBody');
    tbody.innerHTML = '';

    // ä»Šæ—¥ã®æ—¥ä»˜ã®è¨˜éŒ²ã®ã¿è¡¨ç¤ºï¼ˆä»»æ„ã§å¤‰æ›´å¯ï¼‰
    const today = new Date().toISOString().slice(0, 10);

    let total = 0;
    entries.forEach(entry => {
      // ä»Šã¯å…¨ä»¶è¡¨ç¤º
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${entry.time}</td>
        <td>${entry.foodName}</td>
        <td>${entry.quantity}</td>
        <td>${entry.calorie.toLocaleString()} kcal</td>
      `;
      tbody.appendChild(tr);
      total += entry.calorie;
    });
    document.getElementById('totalCalories').textContent = 'åˆè¨ˆ: ' + total.toLocaleString() + ' kcal';
  }

  // å…¨å‰Šé™¤
  function clearAll() {
    if (confirm('å…¨ã¦ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      entries = [];
      localStorage.setItem('entries', JSON.stringify(entries));
      renderEntries();
    }
  }

  // é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
  const registerModal = document.getElementById('registerModal');
  function openRegisterModal() {
    registerModal.style.display = 'block';
    registerModal.setAttribute('aria-hidden', 'false');
    document.getElementById('foodNameInput').focus();
  }
  function closeRegisterModal() {
    registerModal.style.display = 'none';
    registerModal.setAttribute('aria-hidden', 'true');
  }

  // é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²
  function addFoodData() {
    const name = document.getElementById('foodNameInput').value.trim();
    const calorie = Number(document.getElementById('foodCalorieInput').value);
    if (!name || !calorie || calorie <= 0) {
      alert('æ­£ã—ã„é£Ÿå“åã¨ã‚«ãƒ­ãƒªãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }
    if (foodData.some(f => f.name === name)) {
      alert('åŒã˜åå‰ã®é£Ÿå“ãŒæ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
      return;
    }
    foodData.push({ name, calorie });
    localStorage.setItem('foodData', JSON.stringify(foodData));
    populateFoodSelect();
    closeRegisterModal();
    document.getElementById('foodRegisterForm').reset();
  }

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
  const calendarModal = document.getElementById('calendarModal');
  function openCalendarModal() {
    calendarModal.style.display = 'block';
    calendarModal.setAttribute('aria-hidden', 'false');
    renderCalendar();
  }
  function closeCalendarModal() {
    calendarModal.style.display = 'none';
    calendarModal.setAttribute('aria-hidden', 'true');
  }

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºç”¨é–¢æ•°ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  function renderCalendar() {
    const container = document.getElementById('calendarContainer');
    container.innerHTML = '';

    // æœˆåˆã¨æœˆæœ«ã‚’æ±ºå®šï¼ˆä»Šæœˆï¼‰
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    const table = document.createElement('table');
    table.style.width = '100%';
    table.style.borderCollapse = 'collapse';

    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œï¼ˆæ›œæ—¥ï¼‰
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'].forEach(dayName => {
      const th = document.createElement('th');
      th.textContent = dayName;
      th.style.border = '1px solid #f48fb1';
      th.style.padding = '6px';
      th.style.backgroundColor = '#f8bbd0';
      th.style.color = '#b71c1c';
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // ãƒœãƒ‡ã‚£
    const tbody = document.createElement('tbody');
    let tr = document.createElement('tr');
    let dayOfWeek = firstDay.getDay();

    // ç©ºã‚»ãƒ«åŸ‹ã‚
    for (let i = 0; i < dayOfWeek; i++) {
      const td = document.createElement('td');
      td.style.border = '1px solid #f48fb1';
      td.style.padding = '8px';
      tr.appendChild(td);
    }

    // æ—¥ä»˜ã‚»ãƒ«ä½œæˆ
    for (let day = 1; day <= daysInMonth; day++) {
      if (dayOfWeek === 7) {
        tbody.appendChild(tr);
        tr = document.createElement('tr');
        dayOfWeek = 0;
      }
      const td = document.createElement('td');
      td.style.border = '1px solid #f48fb1';
      td.style.padding = '6px';
      td.style.verticalAlign = 'top';
      td.style.height = '80px';
      td.style.fontSize = '14px';
      td.style.position = 'relative';

      const dateStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      // æ—¥ä»˜è¡¨ç¤º
      const dayLabel = document.createElement('div');
      dayLabel.textContent = day;
      dayLabel.style.fontWeight = 'bold';
      dayLabel.style.color = '#b71c1c';
      td.appendChild(dayLabel);

      // ãã®æ—¥ã®åˆè¨ˆã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤º
      const calSum = entries
        .filter(e => e.date === dateStr)
        .reduce((sum, e) => sum + e.calorie, 0);
      if (calSum > 0) {
        const calLabel = document.createElement('div');
        calLabel.textContent = `${calSum} kcal`;
        calLabel.style.color = '#ef6c00';
        calLabel.style.fontSize = '12px';
        calLabel.style.marginTop = '6px';
        td.appendChild(calLabel);
      }

      tr.appendChild(td);
      dayOfWeek++;
    }

    // æœ€çµ‚é€±ã®ç©ºã‚»ãƒ«åŸ‹ã‚
    while (dayOfWeek > 0 && dayOfWeek < 7) {
      const td = document.createElement('td');
      td.style.border = '1px solid #f48fb1';
      td.style.padding = '8px';
      tr.appendChild(td);
      dayOfWeek++;
    }

    tbody.appendChild(tr);
    table.appendChild(tbody);
    container.appendChild(table);
  }
</script>

</body>
</html>
