<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼è¨˜éŒ²</title>
<style>
.calendar-nav-btn {
  background: #ff6666;
  color: #fff;
border: none;
 flex-grow: 0 !important; /* â†ã“ã®å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã¯åŠè§’ã«ä¿®æ­£ */
  padding: 2px 6px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  line-height: 1;
  width: auto;
}

  /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºå…¨ä½“ã‚’å°‘ã—å°ã•ã */
  body {
    font-family: 'Arial', sans-serif;
    font-size: 14px; /* å…ƒã¯16pxãã‚‰ã„æƒ³å®šãªã®ã§ä¸€å›ã‚Šå°ã•ã */
    margin: 20px;
    background: #fff0f0;
    color: #800000;
  }
  h1 {
    text-align: center;
    margin-bottom: 40px;
    font-weight: bold;
    font-size: 1.6rem;
    position: relative;
  }
  /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã¯ã‚¿ã‚¤ãƒˆãƒ«å³ä¸‹ã« */
  #calendarOpenBtn {
    position: absolute;
    right: 10px;
    top: 40px;
    background-color: #ff6666;
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
  }
  #calendarOpenBtn:hover {
    background-color: #ff4d4d;
  }

  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ */
  .form-row {
    display: flex;
    gap: 12px;
    margin-bottom: 8px;
    align-items: center;
  }
  .form-label {
    min-width: 60px;
    color: #cc0033;
    font-weight: 600;
  }
  input[type="date"],
  select,
  input[type="number"] {
    flex-grow: 1;
    padding: 4px 6px;
    border: 1.5px solid #ff9999;
    border-radius: 5px;
    font-size: 0.95rem;
  }
  select:invalid {
    color: #999999;
  }

/* ç‰¹å®šã®ãƒœã‚¿ãƒ³ç¾¤ã®ã¿æ¨ªã«åºƒãŒã‚‹ã‚ˆã†ã« */
.button-row {
  display: flex;
  gap: 8px;
  margin-bottom: 16px; /* â† ã“ã“ã‚’è¿½åŠ  */
}

.button-row button {
  flex-grow: 1; /* å‡ç­‰ã«åºƒãŒã‚‹ */
}

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†…ã®æœˆãƒœã‚¿ãƒ³ */
.calendar-nav-btn {
  flex-grow: 0;
  width: auto;
  padding: 2px 6px;
  font-size: 12px;
}

/* ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#registerCloseBtn {
  background: transparent;
  color: #cc0000;
  border: none;
  font-size: 1.4rem;
  cursor: pointer;
  margin-left: auto;
}
button {
  background-color: #ff8080;
  border: none;
  color: white;
  padding: 8px 0;
  font-weight: 600;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  transition: background-color 0.3s;
}  button:hover:not(:disabled) {
    background-color: #ff4d4d;
  }
  button:disabled {
    background-color: #f0baba;
    cursor: default;
  }

  /* ãƒ†ãƒ¼ãƒ–ãƒ« */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 6px;
    font-size: 0.7rem;
  }
  th, td {
    border: 1px solid #ff9999;
    padding: 6px 8px;
    text-align: center;
    color: #800000;
  }
  th {
    background-color: #ffd6d6;
  }

  /* åˆè¨ˆã‚«ãƒ­ãƒªãƒ¼è¡¨ç¤ºã‚’ãƒ†ãƒ¼ãƒ–ãƒ«å³ä¸‹ã« */
  #totalCalories {
    text-align: right;
    font-weight: 700;
    color: #cc0000;
    font-size: 1.6rem;
    margin-top: -6px;
    margin-bottom: 20px;
  }

  /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« */
  #calendarModal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0; right: 0; bottom: 0;
    background: rgba(255, 200, 200, 0.9);
    overflow: auto;
    padding: 20px;
  }
  #calendarContent {
    background: white;
    max-width: 320px;
    margin: 50px auto;
    padding: 12px;
    border-radius: 10px;
  }
  #calendarGrid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    text-align: center;
  }
#calendarGrid > div {
  position: relative;
  min-height: 48px; /* ä»¥å‰ã‚ˆã‚Šå°‘ã—å¤§ãã‚ã« */
  padding: 4px;
  border-radius: 6px;
  cursor: pointer;
  user-select: none;
  font-size: 0.8rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

  }
  #calendarGrid > div:hover,
  #calendarGrid > div:focus {
    background-color: #ffcccc;
    outline: none;
  }
  #calendarGrid .empty {
    cursor: default;
    background: transparent;
  }
.kcalLabel {
  font-size: 0.7rem;
  color: #cc3333;
  font-weight: 700;
  margin-top: 2px;
}
  #calendarCloseBtn {
    margin-top: 12px;
    padding: 6px 14px;
    background-color: #ff6666;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }
  #calendarCloseBtn:hover {
    background-color: #ff4d4d;
  }
  /* é¸æŠã—ã¦ã„ãªã„é£Ÿå“åã®è‰²ã‚’ç°è‰²ã« */
  select:invalid {
    color: #999999;
  }
.day {
  border: 1px solid #ccc;
  padding: 8px;
  margin: 2px;
  min-height: 60px;
  box-sizing: border-box;
  position: relative;
  background-color: #fefefe;
  border-radius: 4px;
}
#registerModal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1100;
  padding: 16px;
  box-sizing: border-box;
  overflow: hidden; /* â†å¤‰æ›´ãƒã‚¤ãƒ³ãƒˆ */
}

#registerContent {
  width: 100%;
  max-width: 450px;
  max-height: 90vh;
  background-color: #fff;
  border-radius: 12px;
  padding: 20px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* â†è¿½åŠ  */
  box-sizing: border-box;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

</style>
</head>
<body>
  <h1>
    æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼è¨˜éŒ²
    <button id="calendarOpenBtn" aria-haspopup="dialog" aria-expanded="false" aria-controls="calendarModal">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  </h1>

  <form id="inputForm" onsubmit="return false;">
    <div class="form-row">
      <label for="calendarDate" class="form-label">æ—¥ä»˜ï¼š</label><input type="date" id="calendarDate" required />
      <label for="timeSelect" class="form-label">æ™‚é–“ï¼š</label>
      <select id="timeSelect" required>
        <option value="æœ">æœ</option>
        <option value="æ˜¼">æ˜¼</option>
        <option value="å¤•">å¤•</option>
    <option value="å°±å¯å‰">å°±å¯å‰</option>
        <option value="é–“é£Ÿ">é–“é£Ÿ</option>
      </select>
    </div>
    <div class="form-row">
      <label for="foodSelect" class="form-label">é£Ÿå“åï¼š</label>
      <select id="foodSelect" required style="width: 100px;">
        <option value="" disabled selected>é¸æŠã—ã¦ãã ã•ã„</option>
      </select>
      <label for="quantitySelect" class="form-label">æ•°é‡ï¼š</label>
      <select id="quantitySelect" required>
        <!-- æ•°é‡1~10 -->
      </select>
    </div>
    <div class="button-row">
      <button id="clearAllBtn" type="button">å…¨ã‚¯ãƒªã‚¢</button>
      <button id="openRegisterBtn" type="button">é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²</button>
      <button id="addEntryBtn" type="button" disabled>è¿½åŠ </button>
    </div>
  </form>

  <table aria-label="æ‘‚å–è¨˜éŒ²ä¸€è¦§">
    <thead>
      <tr>
        <th>æ™‚é–“å¸¯</th>
        <th>é£Ÿå“å</th>
        <th>æ•°é‡</th>
        <th>ã‚«ãƒ­ãƒªãƒ¼</th>
      </tr>
    </thead>
    <tbody id="entryTableBody"></tbody>
  </table>

  <div id="totalCalories" aria-live="polite" aria-atomic="true">åˆè¨ˆ: 0 kcal</div>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="calendarModal" role="dialog" aria-modal="true" aria-labelledby="calendarTitle" aria-hidden="true">
    <div id="calendarContent">
      <h2 id="calendarTitle" style="text-align:center ; margin-top:0; color:#cc0033;">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
<button id="prevMonthBtn" class="calendar-nav-btn">â—€</button>
<span id="calendarMonthLabel" style="font-weight: bold; color:#cc0033; font-size:14px;"></span>
<button id="nextMonthBtn" class="calendar-nav-btn">â–¶</button></div>
      <div id="calendarGrid" tabindex="0"></div>
      <button id="calendarCloseBtn">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <!-- é£Ÿå“ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="registerModal" role="dialog" aria-modal="true" aria-labelledby="registerTitle" aria-hidden="true" style="display:none; position:fixed; z-index:1100; left:0;top:0;right:0;bottom:0; background: rgba(255, 200, 200, 0.9); overflow:auto;">
  <div id="registerContent">
<div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
  <h2>é£Ÿå“ãƒ‡ãƒ¼ã‚¿ç™»éŒ²</h2>
<button id="registerCloseBtn"
  style="
    font-size: 1.5em;
    background: none;
    border: none;
    cursor: pointer;
    width: 3.0em;
    height: 1.5em;
    line-height: 1.5em;
    text-align: center;
    padding: 0;
    margin: 0;
  "
>
  é–‰ã˜ã‚‹
</button>
</div>
      <label for="newFoodName" style="display:block; margin-bottom:6px;">é£Ÿå“åï¼š</label>
      <input type="text" id="newFoodName" style="width:100%; padding:6px; border:1.5px solid #ff9999; border-radius:6px; margin-bottom:10px; font-size: 16px;" />
      <label for="newFoodCalories" style="display:block; margin-bottom:6px;">ã‚«ãƒ­ãƒªãƒ¼(kcal)ï¼š</label>
      <input type="number" id="newFoodCalories" min="1" style="width:100%; padding:6px; border:1.5px solid #ff9999; border-radius:6px; margin-bottom:10px; font-size: 16px;" />
      <button id="addFoodItemBtn" style="background:#ff6666; color:#fff; border:none; padding:8px; border-radius:8px; width:100%; font-weight:600; cursor:pointer;">ç™»éŒ²</button>
<button id="sortFoodsBtn" style="background:#cc0000; color:#fff; border:none; padding:8px; border-radius:8px; width:100%; font-weight:600; cursor:pointer; margin-top:8px;">ä¸¦ã³æ›¿ãˆ</button>
      <ul id="foodListDisplay" style="margin-top:10px; color:#cc0033; font-size:0.85rem;"></ul>
<button id="deleteSelectedFoodsBtn" style="background:#cc0000; color:#fff; border:none; padding:8px; border-radius:8px; width:100%; font-weight:600; cursor:pointer; margin-top:8px;">é¸æŠã—ãŸé£Ÿå“ã‚’å‰Šé™¤</button>

    </div>
  </div>

<script>
(() => {
  // DOMè¦ç´ å–å¾—
  const calendarOpenBtn = document.getElementById('calendarOpenBtn');
  const calendarModal = document.getElementById('calendarModal');
  const calendarCloseBtn = document.getElementById('calendarCloseBtn');
  const calendarDate = document.getElementById('calendarDate');
  const timeSelect = document.getElementById('timeSelect');
  const foodSelect = document.getElementById('foodSelect');
  const quantitySelect = document.getElementById('quantitySelect');
  const addEntryBtn = document.getElementById('addEntryBtn');
  const clearAllBtn = document.getElementById('clearAllBtn');
  const openRegisterBtn = document.getElementById('openRegisterBtn');
  const entryTableBody = document.getElementById('entryTableBody');
  const totalCalories = document.getElementById('totalCalories');
  const registerModal = document.getElementById('registerModal');
  const registerCloseBtn = document.getElementById('registerCloseBtn');
  const addFoodItemBtn = document.getElementById('addFoodItemBtn');
  const newFoodName = document.getElementById('newFoodName');
  const newFoodCalories = document.getElementById('newFoodCalories');
  const foodListDisplay = document.getElementById('foodListDisplay');
  const sortFoodsBtn = document.getElementById('sortFoodsBtn');

sortFoodsBtn.addEventListener('click', () => {
  sortCustomFoods();
});

  // ä¿å­˜ãƒ‡ãƒ¼ã‚¿
  let entriesByDate = JSON.parse(localStorage.getItem('entriesByDate') || '{}');
  let customFoods = JSON.parse(localStorage.getItem('customFoods') || '[]');

function updateFoodListDisplay() {
  foodListDisplay.innerHTML = '';
  customFoods.forEach(food => {
    const li = document.createElement('li');
    li.textContent = `${food.name} (${food.kcal} kcal)`;
    foodListDisplay.appendChild(li);
  });
}

function sortCustomFoods() {
  customFoods.sort((a, b) =>
    a.name.localeCompare(b.name, 'ja', { usage: 'sort', sensitivity: 'base' })
  );
  saveCustomFoods();
  updateFoodListDisplay();
  updateFoodSelect();
}

  let currentCalendarDate = new Date(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã®ç¾åœ¨æ—¥ä»˜

  // äºˆã‚ç”¨æ„ã—ãŸé£Ÿå“ï¼ˆä¾‹ï¼‰
  const predefinedFoods = [
    { name: '', kcal: 0 },
  ];

  // ä»Šæ—¥ã®æ—¥ä»˜ã‚’åˆæœŸå€¤ã‚»ãƒƒãƒˆ
  function formatDateToInput(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  calendarDate.value = formatDateToInput(new Date());

  // æ•°é‡ã‚»ãƒ¬ã‚¯ãƒˆã«1~10ã¾ã§ã‚’ã‚»ãƒƒãƒˆ
function initQuantityOptions() {
  quantitySelect.innerHTML = '';
  for (let i = 1; i <= 100; i++) {
    const value = (i * 0.1).toFixed(1);  // 0.1, 0.2, ..., 10.0
    const opt = document.createElement('option');
    opt.value = value;
    opt.textContent = value;
    if (value === '1.0') {
      opt.selected = true;  // 1.0 ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠ
    }

    quantitySelect.appendChild(opt);
  }
}
initQuantityOptions();
  // é£Ÿå“ã‚»ãƒ¬ã‚¯ãƒˆã‚’æ›´æ–°ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‹ã‚«ã‚¹ã‚¿ãƒ ï¼‰
  function updateFoodSelect() {
    const prevVal = foodSelect.value;
    foodSelect.innerHTML = '';
    const defaultOpt = document.createElement('option');
    defaultOpt.value = '';
    defaultOpt.disabled = true;
    defaultOpt.selected = true;
    defaultOpt.textContent = 'é¸æŠã—ã¦ãã ã•ã„';
    foodSelect.appendChild(defaultOpt);

    const allFoods = [...customFoods];
    allFoods.forEach(f => {
      const opt = document.createElement('option');
      opt.value = f.name;
      opt.textContent = f.name;
      foodSelect.appendChild(opt);
    });
    if ([...foodSelect.options].some(o => o.value === prevVal)) {
      foodSelect.value = prevVal;
    }
    checkAddButtonState();
  }
  updateFoodSelect();

  // è¿½åŠ ãƒœã‚¿ãƒ³æ´»æ€§åˆ¤å®šï¼ˆé£Ÿå“åé¸æŠå¿…é ˆï¼‰
  function checkAddButtonState() {
    addEntryBtn.disabled = foodSelect.value === '';
  }
  foodSelect.addEventListener('change', checkAddButtonState);

  // ç™»éŒ²ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºæ›´æ–°
  function updateEntryTable() {
    const dateKey = calendarDate.value;
    entryTableBody.innerHTML = '';
    if (!entriesByDate[dateKey]) {
      totalCalories.textContent = 'åˆè¨ˆ: 0 kcal';
      return;
    }
    let total = 0;
entriesByDate[dateKey].forEach((entry, index) => {
  const tr = document.createElement('tr');
  const calorieValue = Math.ceil(entry.kcal * entry.quantity);
  tr.innerHTML = `<td>${entry.time}</td><td>${entry.food}</td><td>${entry.quantity}</td><td>${calorieValue} kcal</td>`;

  // è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãã®è¡Œã‚’å‰Šé™¤
  tr.addEventListener('click', () => {
    if (confirm(`ã€Œ${entry.food}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
      entriesByDate[dateKey].splice(index, 1);
      if (entriesByDate[dateKey].length === 0) {
        delete entriesByDate[dateKey];
      }
      saveEntries();
      updateEntryTable();
    }
  });

  entryTableBody.appendChild(tr);
  total += entry.kcal * entry.quantity;
});
const totalRounded = Math.ceil(total);
totalCalories.textContent = `åˆè¨ˆ: ${totalRounded} kcal`;
  }

  // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  function saveEntries() {
    localStorage.setItem('entriesByDate', JSON.stringify(entriesByDate));
  }
  function saveCustomFoods() {
    localStorage.setItem('customFoods', JSON.stringify(customFoods));
  }

  // è¿½åŠ ãƒœã‚¿ãƒ³å‡¦ç†
  addEntryBtn.addEventListener('click', () => {
    const dateKey = calendarDate.value;
    const time = timeSelect.value;
    const foodName = foodSelect.value;
    const quantity = parseFloat(quantitySelect.value);
    if (!dateKey || !time || !foodName || !quantity) return;
 
    // kcalå–å¾—
    let kcal = 0;
    const allFoods = [...predefinedFoods, ...customFoods];
    const foodData = allFoods.find(f => f.name === foodName);
    if (!foodData) return;
    kcal = foodData.kcal;

    if (!entriesByDate[dateKey]) entriesByDate[dateKey] = [];
    entriesByDate[dateKey].push({ time, food: foodName, quantity, kcal });
    saveEntries();
    updateEntryTable();
  });

  // å…¨å‰Šé™¤ãƒœã‚¿ãƒ³å‡¦ç†
  clearAllBtn.addEventListener('click', () => {
    if (!calendarDate.value) return;
    if (confirm('æœ¬å½“ã«å…¨ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      delete entriesByDate[calendarDate.value];
      saveEntries();
      updateEntryTable();
    }
  });

  // æ—¥ä»˜å¤‰æ›´æ™‚ã«ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
  calendarDate.addEventListener('change', () => {
    updateEntryTable();
  });

  // æœ€åˆã®è¡¨ç¤ºæ›´æ–°
  updateEntryTable();

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–‹é–‰
  calendarOpenBtn.addEventListener('click', () => {
    calendarModal.style.display = 'block';
    calendarModal.setAttribute('aria-hidden', 'false');
    calendarOpenBtn.setAttribute('aria-expanded', 'true');
    buildCalendar(calendarDate.value);
  });
  calendarCloseBtn.addEventListener('click', () => {
    calendarModal.style.display = 'none';
    calendarModal.setAttribute('aria-hidden', 'true');
    calendarOpenBtn.setAttribute('aria-expanded', 'false');
  });

  // ğŸ”½ ã“ã®ã‚ãŸã‚Šã«è¿½åŠ 
  document.getElementById('prevMonthBtn').addEventListener('click', () => {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
    buildCalendar(formatDateToInput(currentCalendarDate));
  });

  document.getElementById('nextMonthBtn').addEventListener('click', () => {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
    buildCalendar(formatDateToInput(currentCalendarDate));
  });

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ§‹ç¯‰
function buildCalendar(dateStr) {
  const calendarGrid = document.getElementById('calendarGrid');
  calendarGrid.innerHTML = '';

  currentCalendarDate = new Date(dateStr); // è¡¨ç¤ºä¸­ã®å¹´æœˆæ—¥ã‚’æ›´æ–°
  const year = currentCalendarDate.getFullYear();
  const month = currentCalendarDate.getMonth();

  // æœˆè¡¨ç¤ºæ›´æ–°
  document.getElementById('calendarMonthLabel').textContent = `${year}å¹´ ${month + 1}æœˆ`;

  // æ›œæ—¥è¦‹å‡ºã—è¿½åŠ ï¼ˆæ—¥ã€œåœŸï¼‰
  ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'].forEach(dayName => {
    const dayEl = document.createElement('div');
    dayEl.textContent = dayName;
    dayEl.style.fontWeight = 'bold';
    calendarGrid.appendChild(dayEl);
  });

  // æœˆåˆã‚ã®æ›œæ—¥
  const firstDay = new Date(year, month, 1);
  const startDay = firstDay.getDay();

  // æœˆæœ«æ—¥ï¼ˆãã®æœˆã®æ—¥æ•°ï¼‰
  const lastDate = new Date(year, month + 1, 0).getDate();

  // ç©ºç™½ã‚»ãƒ«ã‚’å…ˆé ­ã«é…ç½®ï¼ˆstartDayåˆ†ï¼‰
  for (let i = 0; i < startDay; i++) {
    const emptyCell = document.createElement('div');
    emptyCell.classList.add('empty');
    calendarGrid.appendChild(emptyCell);
  }

  // æ—¥ä»˜ã‚»ãƒ«ç”Ÿæˆ
  for (let day = 1; day <= lastDate; day++) {
    const dateCell = document.createElement('div');
  dateCell.classList.add('day'); 
    dateCell.tabIndex = 0; // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½
    dateCell.textContent = day;

    // è©²å½“æ—¥ä»˜ã®ã‚«ãƒ­ãƒªãƒ¼åˆè¨ˆãŒã‚ã‚Œã°è¡¨ç¤º
    const key = formatDateToInput(new Date(year, month, day));
    let dayTotal = 0;
    if (entriesByDate[key]) {
      entriesByDate[key].forEach(entry => {
        dayTotal += entry.kcal * entry.quantity;
      });
    }
    if (dayTotal > 0) {
      const kcalLabel = document.createElement('div');
      kcalLabel.className = 'kcalLabel';
      kcalLabel.textContent = `${Math.ceil(dayTotal)} kcal`;
      dateCell.appendChild(kcalLabel);
    }

    // ã‚¯ãƒªãƒƒã‚¯ã§æ—¥ä»˜é¸æŠã—ã¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–‰ã˜ã‚‹
    dateCell.addEventListener('click', () => {
      calendarDate.value = key;
      updateEntryTable();
      calendarModal.style.display = 'none';
      calendarModal.setAttribute('aria-hidden', 'true');
      calendarOpenBtn.setAttribute('aria-expanded', 'false');
      calendarOpenBtn.focus();
    });

    calendarGrid.appendChild(dateCell);
  }
}

  // é£Ÿå“ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰
  openRegisterBtn.addEventListener('click', () => {
    registerModal.style.display = 'block';
    registerModal.setAttribute('aria-hidden', 'false');
    newFoodName.value = '';
    newFoodCalories.value = '';
    updateFoodListDisplay();
  });
  registerCloseBtn.addEventListener('click', () => {
    registerModal.style.display = 'none';
    registerModal.setAttribute('aria-hidden', 'true');
  });

  // é£Ÿå“ç™»éŒ²ãƒªã‚¹ãƒˆè¡¨ç¤º
function updateFoodListDisplay() {
  foodListDisplay.innerHTML = '';
  if (customFoods.length === 0) {
    foodListDisplay.textContent = 'ç™»éŒ²ã•ã‚ŒãŸé£Ÿå“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
    return;
  }
  customFoods.forEach((f, i) => {
    const li = document.createElement('li');
    li.style.display = 'flex';
    li.style.alignItems = 'center';
    li.style.gap = '8px';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.dataset.index = i;

    const label = document.createElement('label');
    label.textContent = `${f.name} : ${f.kcal} kcal`;

    li.appendChild(checkbox);
    li.appendChild(label);
    foodListDisplay.appendChild(li);
  });
}
const deleteSelectedFoodsBtn = document.getElementById('deleteSelectedFoodsBtn');

deleteSelectedFoodsBtn.addEventListener('click', () => {
  // ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é›†ã‚ã‚‹
  const checkboxes = foodListDisplay.querySelectorAll('input[type="checkbox"]:checked');
  if (checkboxes.length === 0) {
    alert('å‰Šé™¤ã™ã‚‹é£Ÿå“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
    return;
  }
  if (!confirm('é¸æŠã—ãŸé£Ÿå“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
    return;
  }

  // é¸æŠã•ã‚ŒãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é€†é †ã«ã—ã¦å‰Šé™¤ï¼ˆé…åˆ—ã®indexå´©ã‚Œé˜²æ­¢ï¼‰
  const indices = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index, 10)).sort((a,b) => b - a);
  indices.forEach(i => {
    customFoods.splice(i, 1);
  });

  saveCustomFoods();
  updateFoodSelect();
  updateFoodListDisplay();
});

  // é£Ÿå“è¿½åŠ ç™»éŒ²
  addFoodItemBtn.addEventListener('click', () => {
    const name = newFoodName.value.trim();
    const kcal = parseInt(newFoodCalories.value, 10);
    if (!name || isNaN(kcal) || kcal <= 0) {
      alert('æ­£ã—ã„é£Ÿå“åã¨ã‚«ãƒ­ãƒªãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }
    if (customFoods.find(f => f.name === name)) {
      alert('æ—¢ã«åŒã˜åå‰ã®é£Ÿå“ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚');
      return;
    }
    customFoods.push({ name, kcal });
    saveCustomFoods();
    updateFoodSelect();
    updateFoodListDisplay();

    newFoodName.value = '';
    newFoodCalories.value = '';
    newFoodName.focus();
  });

})();
</script>
</body>
</html>
